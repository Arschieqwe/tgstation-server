<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>tgstation-server: src/Tgstation.Server.Host.Service/Program.cs Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="tgs.ico"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tgstation-server
   &#160;<span id="projectnumber">4.3.0</span>
   </div>
   <div id="projectbrief">The /tg/station 13 server suite</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="features.html"><span>Features</span></a></li>
      <li><a href="api.html"><span>API</span></a></li>
      <li><a href="architecture.html"><span>Architecture</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_a01d946a2e1b048dc542232ffcdcf572.html">Tgstation.Server.Host.Service</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Program.cs</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_service_2_program_8cs.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">using</span> McMaster.Extensions.CommandLineUtils;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">using</span> Microsoft.Extensions.Logging;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Collections.Specialized;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Configuration.Install;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Diagnostics;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Globalization;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Linq;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Reflection;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Security.Principal;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.ServiceProcess;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Threading.Tasks;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Windows.Forms;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_tgstation.html">Tgstation</a>.<a class="code" href="namespace_tgstation_1_1_server.html">Server</a>.<a class="code" href="namespace_tgstation_1_1_server_1_1_host.html">Host</a>.<a class="code" href="namespace_tgstation_1_1_server_1_1_host_1_1_watchdog.html">Watchdog</a>;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno"><a class="line" href="namespace_tgstation_1_1_server_1_1_host_1_1_service.html">   16</a></span>&#160;<span class="keyword">namespace </span><a class="code" href="namespace_tgstation.html">Tgstation</a>.<a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_server.html">Server</a>.Host.Service</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;{</div><div class="line"><a name="l00021"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html">   21</a></span>&#160;    sealed <span class="keyword">class </span><a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html">Program</a></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    {</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#pragma warning disable SA1401 // Fields should be private</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;        <span class="keyword">internal</span> <span class="keyword">static</span> <a class="code" href="interface_tgstation_1_1_server_1_1_host_1_1_watchdog_1_1_i_watchdog_factory.html">IWatchdogFactory</a> <a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_watchdog_1_1_watchdog_factory.html">WatchdogFactory</a> = <span class="keyword">new</span> WatchdogFactory();</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#pragma warning restore SA1401 // Fields should be private</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        [Option(ShortName = <span class="stringliteral">&quot;u&quot;</span>)]</div><div class="line"><a name="l00034"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a6868da29a3857b56bba33e5d7c623b68">   34</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> Uninstall { <span class="keyword">get</span>; }</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        [Option(ShortName = <span class="stringliteral">&quot;i&quot;</span>)]</div><div class="line"><a name="l00040"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#ae3be244b24cbb3c9ba859f55e53715e6">   40</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> Install { <span class="keyword">get</span>; <span class="keyword">set</span>; }</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        [Option(ShortName = <span class="stringliteral">&quot;c&quot;</span>)]</div><div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#aaba3eb445c2c2c0f8a11d150096b7457">   46</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> Configure { <span class="keyword">get</span>; <span class="keyword">set</span>; }</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        [Option(ShortName = <span class="stringliteral">&quot;t&quot;</span>)]</div><div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a5d7201b8cfa09c341ec68d81297aabad">   52</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> Trace { <span class="keyword">get</span>; <span class="keyword">set</span>; }</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        [Option(ShortName = <span class="stringliteral">&quot;d&quot;</span>)]</div><div class="line"><a name="l00058"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a938d576ceba93bf3cb1a32ae1dcccc52">   58</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> Debug { <span class="keyword">get</span>; <span class="keyword">set</span>; }</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a5c942ce276ce92ca31ecbe9c88f2e982">   64</a></span>&#160;        <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a5c942ce276ce92ca31ecbe9c88f2e982">IsAdministrator</a>()</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        {</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;            var user = WindowsIdentity.GetCurrent();</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;            var principal = <span class="keyword">new</span> WindowsPrincipal(user);</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;            <span class="keywordflow">return</span> principal.IsInRole(WindowsBuiltInRole.Administrator);</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        }</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <span class="keyword">static</span> Task&lt;int&gt; Main(<span class="keywordtype">string</span>[] args) =&gt; CommandLineApplication.ExecuteAsync&lt;<a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html">Program</a>&gt;(args);</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a86d24d735c64eb7c67a935b809927dd4">   80</a></span>&#160;        <span class="keyword">public</span> async Task <a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a86d24d735c64eb7c67a935b809927dd4">OnExecuteAsync</a>()</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        {</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;            <span class="keywordflow">if</span> (Environment.UserInteractive)</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;            {</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                <span class="keywordflow">if</span> (!Install &amp;&amp; !Uninstall &amp;&amp; !Configure)</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                {</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                    var result = MessageBox.Show(<span class="stringliteral">&quot;You are running the TGS windows service executable directly. It should only be run by the service control manager. Would you like to install and configure the service in this location?&quot;</span>, <span class="stringliteral">&quot;TGS Service&quot;</span>, MessageBoxButtons.YesNo);</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                    <span class="keywordflow">if</span> (result != DialogResult.Yes)</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                    Install = <span class="keyword">true</span>;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                    Configure = <span class="keyword">true</span>;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                }</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                <span class="keywordflow">if</span> (!IsAdministrator())</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                {</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                    <span class="comment">// try to restart as admin</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                    <span class="comment">// its windows, first arg is .exe name guaranteed</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                    var exe = Environment.GetCommandLineArgs().First();</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                    var startInfo = <span class="keyword">new</span> ProcessStartInfo</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                    {</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                        UseShellExecute = <span class="keyword">true</span>,</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                        Verb = <span class="stringliteral">&quot;runas&quot;</span>,</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                        Arguments = String.Format(CultureInfo.InvariantCulture, <span class="stringliteral">&quot;{0} {1}&quot;</span>, Install ? <span class="stringliteral">&quot;-i&quot;</span> : Uninstall ? <span class="stringliteral">&quot;-u&quot;</span> : String.Empty, Configure ? <span class="stringliteral">&quot;-c&quot;</span> : String.Empty),</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                        FileName = exe,</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                        WorkingDirectory = Environment.CurrentDirectory,</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                    };</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                    <span class="keyword">using</span> (Process.Start(startInfo))</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                }</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            }</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;            <span class="keyword">using</span> (var loggerFactory = <span class="keyword">new</span> LoggerFactory())</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;            {</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                <span class="keywordflow">if</span> (Install)</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                {</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                    <span class="keywordflow">if</span> (Uninstall)</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                        <span class="keywordflow">return</span>; <span class="comment">// oh no, it&#39;s retarded...</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                    <span class="keyword">using</span> (var processInstaller = <span class="keyword">new</span> ServiceProcessInstaller())</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                    <span class="keyword">using</span> (var installer = <span class="keyword">new</span> ServiceInstaller())</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                    {</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                        processInstaller.Account = ServiceAccount.LocalSystem;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                        installer.Context = <span class="keyword">new</span> InstallContext(<span class="stringliteral">&quot;tgs-4-install.log&quot;</span>, <span class="keyword">new</span> <span class="keywordtype">string</span>[] { String.Format(CultureInfo.InvariantCulture, <span class="stringliteral">&quot;/assemblypath={0}&quot;</span>, Assembly.GetEntryAssembly().Location) });</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                        installer.Description = <span class="stringliteral">&quot;/tg/station 13 server v4 running as a windows service&quot;</span>;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                        installer.DisplayName = <span class="stringliteral">&quot;/tg/station server 4&quot;</span>;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                        installer.DelayedAutoStart = <span class="keyword">true</span>;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                        installer.StartType = ServiceStartMode.Automatic;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                        installer.ServicesDependedOn = <span class="keyword">new</span> <span class="keywordtype">string</span>[] { <span class="stringliteral">&quot;Tcpip&quot;</span>, <span class="stringliteral">&quot;Dhcp&quot;</span>, <span class="stringliteral">&quot;Dnscache&quot;</span> };</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                        installer.ServiceName = <a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_server_service.html">ServerService</a>.<a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_server_service.html#a82a1c35bb13819cd1003592351251fc1">Name</a>;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                        installer.Parent = processInstaller;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                        var state = <span class="keyword">new</span> ListDictionary();</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                        installer.Install(state);</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                    }</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                    <span class="keywordflow">if</span> (Configure)</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                    {</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                        Console.WriteLine(<span class="stringliteral">&quot;For this first run we&#39;ll launch the console runner so you may use the setup wizard.&quot;</span>);</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                        Console.WriteLine(<span class="stringliteral">&quot;If it starts successfully, feel free to close it and then start the service from the Windows control panel.&quot;</span>);</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                    }</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                }</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Uninstall)</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                    <span class="keyword">using</span> (var installer = <span class="keyword">new</span> ServiceInstaller())</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                    {</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                        installer.Context = <span class="keyword">new</span> InstallContext(<span class="stringliteral">&quot;tgs-4-uninstall.log&quot;</span>, null);</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                        installer.ServiceName = <a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_server_service.html">ServerService</a>.<a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_server_service.html#a82a1c35bb13819cd1003592351251fc1">Name</a>;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                        installer.Uninstall(null);</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                    }</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!Configure)</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                    <span class="keyword">using</span> (var service = <span class="keyword">new</span> <a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_server_service.html">ServerService</a>(WatchdogFactory, loggerFactory, Trace ? LogLevel.Trace : Debug ? LogLevel.Debug : LogLevel.Information))</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                        <a class="code" href="class_service_base.html">ServiceBase</a>.Run(service);</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                <span class="keywordflow">if</span> (Configure)</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                    await WatchdogFactory.CreateWatchdog(loggerFactory).RunAsync(<span class="keyword">true</span>, Array.Empty&lt;<span class="keywordtype">string</span>&gt;(), <span class="keywordflow">default</span>).ConfigureAwait(<span class="keyword">false</span>);</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            }</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        }</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    }</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;}</div><div class="ttc" id="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program_html_a86d24d735c64eb7c67a935b809927dd4"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a86d24d735c64eb7c67a935b809927dd4">Tgstation.Server.Host.Service.Program.OnExecuteAsync</a></div><div class="ttdeci">async Task OnExecuteAsync()</div><div class="ttdoc">Command line handler, always runs </div><div class="ttdef"><b>Definition:</b> <a href="_service_2_program_8cs_source.html#l00080">Program.cs:80</a></div></div>
<div class="ttc" id="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program_html_a5c942ce276ce92ca31ecbe9c88f2e982"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a5c942ce276ce92ca31ecbe9c88f2e982">Tgstation.Server.Host.Service.Program.IsAdministrator</a></div><div class="ttdeci">static bool IsAdministrator()</div><div class="ttdoc">Check if the running user is a system administrator </div><div class="ttdef"><b>Definition:</b> <a href="_service_2_program_8cs_source.html#l00064">Program.cs:64</a></div></div>
<div class="ttc" id="namespace_system_html"><div class="ttname"><a href="namespace_system.html">System</a></div></div>
<div class="ttc" id="class_service_base_html"><div class="ttname"><a href="class_service_base.html">ServiceBase</a></div></div>
<div class="ttc" id="namespace_tgstation_1_1_server_1_1_host_1_1_watchdog_html"><div class="ttname"><a href="namespace_tgstation_1_1_server_1_1_host_1_1_watchdog.html">Tgstation.Server.Host.Watchdog</a></div><div class="ttdef"><b>Definition:</b> <a href="_watchdog_2_i_watchdog_8cs_source.html#l00004">IWatchdog.cs:4</a></div></div>
<div class="ttc" id="interface_tgstation_1_1_server_1_1_host_1_1_watchdog_1_1_i_watchdog_factory_html"><div class="ttname"><a href="interface_tgstation_1_1_server_1_1_host_1_1_watchdog_1_1_i_watchdog_factory.html">Tgstation.Server.Host.Watchdog.IWatchdogFactory</a></div><div class="ttdoc">Factory for creating IWatchdogs </div><div class="ttdef"><b>Definition:</b> <a href="_watchdog_2_i_watchdog_factory_8cs_source.html#l00008">IWatchdogFactory.cs:8</a></div></div>
<div class="ttc" id="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program_html"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html">Tgstation.Server.Host.Service.Program</a></div><div class="ttdoc">Contains the entrypoint for the application </div><div class="ttdef"><b>Definition:</b> <a href="_service_2_program_8cs_source.html#l00021">Program.cs:21</a></div></div>
<div class="ttc" id="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_server_service_html_a82a1c35bb13819cd1003592351251fc1"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_server_service.html#a82a1c35bb13819cd1003592351251fc1">Tgstation.Server.Host.Service.ServerService.Name</a></div><div class="ttdeci">const string Name</div><div class="ttdoc">The canonical windows service name </div><div class="ttdef"><b>Definition:</b> <a href="_server_service_8cs_source.html#l00021">ServerService.cs:21</a></div></div>
<div class="ttc" id="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_server_service_html"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_server_service.html">Tgstation.Server.Host.Service.ServerService</a></div><div class="ttdoc">Represents a IWatchdog as a ServiceBase </div><div class="ttdef"><b>Definition:</b> <a href="_server_service_8cs_source.html#l00016">ServerService.cs:16</a></div></div>
<div class="ttc" id="namespace_tgstation_1_1_server_html"><div class="ttname"><a href="namespace_tgstation_1_1_server.html">Tgstation.Server</a></div></div>
<div class="ttc" id="class_tgstation_1_1_server_1_1_host_1_1_watchdog_1_1_watchdog_factory_html"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_watchdog_1_1_watchdog_factory.html">Tgstation.Server.Host.Watchdog.WatchdogFactory</a></div><div class="ttdef"><b>Definition:</b> <a href="_watchdog_2_watchdog_factory_8cs_source.html#l00007">WatchdogFactory.cs:7</a></div></div>
<div class="ttc" id="class_tgstation_1_1_server_1_1_host_1_1_server_html"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_server.html">Tgstation.Server.Host.Server</a></div><div class="ttdef"><b>Definition:</b> <a href="_server_8cs_source.html#l00018">Server.cs:18</a></div></div>
<div class="ttc" id="namespace_tgstation_1_1_server_1_1_host_html"><div class="ttname"><a href="namespace_tgstation_1_1_server_1_1_host.html">Tgstation.Server.Host</a></div></div>
<div class="ttc" id="namespace_tgstation_html"><div class="ttname"><a href="namespace_tgstation.html">Tgstation</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
