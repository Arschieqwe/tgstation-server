<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>tgstation-server: src/Tgstation.Server.Host.Service/Program.cs Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="tgs.ico"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tgstation-server
   &#160;<span id="projectnumber">4.10.5</span>
   </div>
   <div id="projectbrief">The /tg/station 13 server suite</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_a01d946a2e1b048dc542232ffcdcf572.html">Tgstation.Server.Host.Service</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Program.cs</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_tgstation_8_server_8_host_8_service_2_program_8cs.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">using</span> McMaster.Extensions.CommandLineUtils;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">using</span> Microsoft.Extensions.Logging;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">using</span> System;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">using</span> System.Collections.Specialized;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">using</span> System.Configuration.Install;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">using</span> System.Diagnostics;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">using</span> System.Globalization;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">using</span> System.Linq;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keyword">using</span> System.Reflection;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="keyword">using</span> System.Security.Principal;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="keyword">using</span> System.ServiceProcess;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keyword">using</span> System.Threading.Tasks;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="keyword">using</span> System.Windows.Forms;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_tgstation.html">Tgstation</a>.<a class="code" href="namespace_tgstation_1_1_server.html">Server</a>.<a class="code" href="namespace_tgstation_1_1_server_1_1_host.html">Host</a>.<a class="code" href="namespace_tgstation_1_1_server_1_1_host_1_1_watchdog.html">Watchdog</a>;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160; </div>
<div class="line"><a name="l00016"></a><span class="lineno"><a class="line" href="namespace_tgstation_1_1_server_1_1_host_1_1_service.html">   16</a></span>&#160;<span class="keyword">namespace </span><a class="code" href="namespace_tgstation_1_1_server_1_1_host_1_1_service.html">Tgstation.Server.Host.Service</a></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;{</div>
<div class="line"><a name="l00021"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html">   21</a></span>&#160;    sealed <span class="keyword">class </span><a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html">Program</a></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    {</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;        <span class="keyword">internal</span> <span class="keyword">static</span> <a class="code" href="interface_tgstation_1_1_server_1_1_host_1_1_watchdog_1_1_i_watchdog_factory.html">IWatchdogFactory</a> <a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_watchdog_1_1_watchdog_factory.html">WatchdogFactory</a> = <span class="keyword">new</span> <a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_watchdog_1_1_watchdog_factory.html">WatchdogFactory</a>();</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160; </div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        [Option(ShortName = <span class="stringliteral">&quot;u&quot;</span>)]</div>
<div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a6868da29a3857b56bba33e5d7c623b68">   32</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a6868da29a3857b56bba33e5d7c623b68">Uninstall</a> { <span class="keyword">get</span>; }</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160; </div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        [Option(ShortName = <span class="stringliteral">&quot;i&quot;</span>)]</div>
<div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#ae3be244b24cbb3c9ba859f55e53715e6">   38</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#ae3be244b24cbb3c9ba859f55e53715e6">Install</a> { <span class="keyword">get</span>; <span class="keyword">set</span>; }</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160; </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        [Option(ShortName = <span class="stringliteral">&quot;c&quot;</span>)]</div>
<div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#aaba3eb445c2c2c0f8a11d150096b7457">   44</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#aaba3eb445c2c2c0f8a11d150096b7457">Configure</a> { <span class="keyword">get</span>; <span class="keyword">set</span>; }</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160; </div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        [Option(ShortName = <span class="stringliteral">&quot;t&quot;</span>)]</div>
<div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a5d7201b8cfa09c341ec68d81297aabad">   50</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a5d7201b8cfa09c341ec68d81297aabad">Trace</a> { <span class="keyword">get</span>; <span class="keyword">set</span>; }</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        [Option(ShortName = <span class="stringliteral">&quot;d&quot;</span>)]</div>
<div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a938d576ceba93bf3cb1a32ae1dcccc52">   56</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a938d576ceba93bf3cb1a32ae1dcccc52">Debug</a> { <span class="keyword">get</span>; <span class="keyword">set</span>; }</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a5c942ce276ce92ca31ecbe9c88f2e982">   62</a></span>&#160;        <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a5c942ce276ce92ca31ecbe9c88f2e982">IsAdministrator</a>()</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        {</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;            var user = WindowsIdentity.GetCurrent();</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;            var principal = <span class="keyword">new</span> WindowsPrincipal(user);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;            <span class="keywordflow">return</span> principal.IsInRole(WindowsBuiltInRole.Administrator);</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        }</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160; </div>
<div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a626a9a4670edb87ce05328762d46cf8f">   72</a></span>&#160;        <span class="keyword">static</span> Task&lt;int&gt; <a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a626a9a4670edb87ce05328762d46cf8f">Main</a>(<span class="keywordtype">string</span>[] args) =&gt; CommandLineApplication.ExecuteAsync&lt;<a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html">Program</a>&gt;(args);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160; </div>
<div class="line"><a name="l00078"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a86d24d735c64eb7c67a935b809927dd4">   78</a></span>&#160;        <span class="keyword">public</span> async Task <a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a86d24d735c64eb7c67a935b809927dd4">OnExecuteAsync</a>()</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        {</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;            <span class="keywordflow">if</span> (Environment.UserInteractive)</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;            {</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                <span class="keywordflow">if</span> (!<a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#ae3be244b24cbb3c9ba859f55e53715e6">Install</a> &amp;&amp; !<a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a6868da29a3857b56bba33e5d7c623b68">Uninstall</a> &amp;&amp; !<a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#aaba3eb445c2c2c0f8a11d150096b7457">Configure</a>)</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                {</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                    var result = MessageBox.Show(<span class="stringliteral">&quot;You are running the TGS windows service executable directly. It should only be run by the service control manager. Would you like to install and configure the service in this location?&quot;</span>, <span class="stringliteral">&quot;TGS Service&quot;</span>, MessageBoxButtons.YesNo);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                    <span class="keywordflow">if</span> (result != DialogResult.Yes)</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                    <a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#ae3be244b24cbb3c9ba859f55e53715e6">Install</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                    <a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#aaba3eb445c2c2c0f8a11d150096b7457">Configure</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                }</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160; </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                <span class="keywordflow">if</span> (!<a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a5c942ce276ce92ca31ecbe9c88f2e982">IsAdministrator</a>())</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                {</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                    <span class="comment">// try to restart as admin</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                    <span class="comment">// its windows, first arg is .exe name guaranteed</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                    var exe = Environment.GetCommandLineArgs().First();</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                    var startInfo = <span class="keyword">new</span> ProcessStartInfo</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                    {</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                        UseShellExecute = <span class="keyword">true</span>,</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                        Verb = <span class="stringliteral">&quot;runas&quot;</span>,</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                        Arguments = String.Format(CultureInfo.InvariantCulture, <span class="stringliteral">&quot;{0} {1}&quot;</span>, <a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#ae3be244b24cbb3c9ba859f55e53715e6">Install</a> ? <span class="stringliteral">&quot;-i&quot;</span> : <a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a6868da29a3857b56bba33e5d7c623b68">Uninstall</a> ? <span class="stringliteral">&quot;-u&quot;</span> : String.Empty, <a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#aaba3eb445c2c2c0f8a11d150096b7457">Configure</a> ? <span class="stringliteral">&quot;-c&quot;</span> : String.Empty),</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                        FileName = exe,</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                        WorkingDirectory = Environment.CurrentDirectory,</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                    };</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                    <span class="keyword">using</span> (Process.Start(startInfo))</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                }</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            }</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160; </div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            <span class="keyword">using</span> (var loggerFactory = <span class="keyword">new</span> LoggerFactory())</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;            {</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#ae3be244b24cbb3c9ba859f55e53715e6">Install</a>)</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                {</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a6868da29a3857b56bba33e5d7c623b68">Uninstall</a>)</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                        <span class="keywordflow">return</span>; <span class="comment">// oh no, it&#39;s retarded...</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                    <span class="keyword">using</span> (var processInstaller = <span class="keyword">new</span> ServiceProcessInstaller())</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                    <span class="keyword">using</span> (var installer = <span class="keyword">new</span> ServiceInstaller())</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                    {</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                        processInstaller.Account = ServiceAccount.LocalSystem;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160; </div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                        installer.Context = <span class="keyword">new</span> InstallContext(<span class="stringliteral">&quot;tgs-4-install.log&quot;</span>, <span class="keyword">new</span> <span class="keywordtype">string</span>[] { String.Format(CultureInfo.InvariantCulture, <span class="stringliteral">&quot;/assemblypath={0}&quot;</span>, Assembly.GetEntryAssembly().Location) });</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                        installer.Description = <span class="stringliteral">&quot;/tg/station 13 server v4 running as a windows service&quot;</span>;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                        installer.DisplayName = <span class="stringliteral">&quot;/tg/station server 4&quot;</span>;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                        installer.DelayedAutoStart = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                        installer.StartType = ServiceStartMode.Automatic;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                        installer.ServicesDependedOn = <span class="keyword">new</span> <span class="keywordtype">string</span>[] { <span class="stringliteral">&quot;Tcpip&quot;</span>, <span class="stringliteral">&quot;Dhcp&quot;</span>, <span class="stringliteral">&quot;Dnscache&quot;</span> };</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                        installer.ServiceName = <a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_server_service.html">ServerService</a>.<a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_server_service.html#a82a1c35bb13819cd1003592351251fc1">Name</a>;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                        installer.Parent = processInstaller;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160; </div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                        var state = <span class="keyword">new</span> ListDictionary();</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                        installer.Install(state);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                    }</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160; </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#aaba3eb445c2c2c0f8a11d150096b7457">Configure</a>)</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                    {</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                        Console.WriteLine(<span class="stringliteral">&quot;For this first run we&#39;ll launch the console runner so you may use the setup wizard.&quot;</span>);</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                        Console.WriteLine(<span class="stringliteral">&quot;If it starts successfully, feel free to close it and then start the service from the Windows control panel.&quot;</span>);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                    }</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                }</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a6868da29a3857b56bba33e5d7c623b68">Uninstall</a>)</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                    <span class="keyword">using</span> (var installer = <span class="keyword">new</span> ServiceInstaller())</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                    {</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                        installer.Context = <span class="keyword">new</span> InstallContext(<span class="stringliteral">&quot;tgs-4-uninstall.log&quot;</span>, <span class="keyword">null</span>);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                        installer.ServiceName = <a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_server_service.html">ServerService</a>.<a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_server_service.html#a82a1c35bb13819cd1003592351251fc1">Name</a>;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                        installer.Uninstall(<span class="keyword">null</span>);</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                    }</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#aaba3eb445c2c2c0f8a11d150096b7457">Configure</a>)</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                    <span class="keyword">using</span> (var service = <span class="keyword">new</span> <a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_server_service.html">ServerService</a>(<a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_watchdog_1_1_watchdog_factory.html">WatchdogFactory</a>, loggerFactory, <a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a5d7201b8cfa09c341ec68d81297aabad">Trace</a> ? LogLevel.Trace : <a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a938d576ceba93bf3cb1a32ae1dcccc52">Debug</a> ? LogLevel.Debug : LogLevel.Information))</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                        <a class="code" href="class_service_base.html">ServiceBase</a>.Run(service);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#aaba3eb445c2c2c0f8a11d150096b7457">Configure</a>)</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                {</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="preprocessor">#pragma warning disable CS0618 </span><span class="comment">// Type or member is obsolete</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                    loggerFactory.AddConsole();</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="preprocessor">#pragma warning restore CS0618 </span><span class="comment">// Type or member is obsolete</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160; </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                    <span class="comment">// DCT: None available</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                    await <a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_watchdog_1_1_watchdog_factory.html">WatchdogFactory</a>.<a class="code" href="class_tgstation_1_1_server_1_1_host_1_1_watchdog_1_1_watchdog_factory.html#ae25446ee2a7bb19d9208695d18621914">CreateWatchdog</a>(loggerFactory).<a class="code" href="interface_tgstation_1_1_server_1_1_host_1_1_watchdog_1_1_i_watchdog.html#abe13ec45a7d7ba7db422ea661156b697">RunAsync</a>(<span class="keyword">true</span>, Array.Empty&lt;<span class="keywordtype">string</span>&gt;(), <span class="keywordflow">default</span>).ConfigureAwait(<span class="keyword">false</span>);</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                }</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;            }</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        }</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    }</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;}</div>
<div class="ttc" id="aclass_service_base_html"><div class="ttname"><a href="class_service_base.html">ServiceBase</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_service_1_1_program_html"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html">Tgstation.Server.Host.Service.Program</a></div><div class="ttdoc">Contains the entrypoint for the application</div><div class="ttdef"><b>Definition:</b> <a href="_tgstation_8_server_8_host_8_service_2_program_8cs_source.html#l00021">Program.cs:22</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_service_1_1_program_html_a5c942ce276ce92ca31ecbe9c88f2e982"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a5c942ce276ce92ca31ecbe9c88f2e982">Tgstation.Server.Host.Service.Program.IsAdministrator</a></div><div class="ttdeci">static bool IsAdministrator()</div><div class="ttdoc">Check if the running user is a system administrator</div><div class="ttdef"><b>Definition:</b> <a href="_tgstation_8_server_8_host_8_service_2_program_8cs_source.html#l00062">Program.cs:62</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_service_1_1_program_html_a5d7201b8cfa09c341ec68d81297aabad"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a5d7201b8cfa09c341ec68d81297aabad">Tgstation.Server.Host.Service.Program.Trace</a></div><div class="ttdeci">bool Trace</div><div class="ttdoc">The –trace or -t option. Enables trace logs</div><div class="ttdef"><b>Definition:</b> <a href="_tgstation_8_server_8_host_8_service_2_program_8cs_source.html#l00050">Program.cs:50</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_service_1_1_program_html_a626a9a4670edb87ce05328762d46cf8f"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a626a9a4670edb87ce05328762d46cf8f">Tgstation.Server.Host.Service.Program.Main</a></div><div class="ttdeci">static Task&lt; int &gt; Main(string[] args)</div><div class="ttdoc">Entrypoint for the application</div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_service_1_1_program_html_a6868da29a3857b56bba33e5d7c623b68"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a6868da29a3857b56bba33e5d7c623b68">Tgstation.Server.Host.Service.Program.Uninstall</a></div><div class="ttdeci">bool Uninstall</div><div class="ttdoc">The –uninstall or -u option</div><div class="ttdef"><b>Definition:</b> <a href="_tgstation_8_server_8_host_8_service_2_program_8cs_source.html#l00032">Program.cs:32</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_service_1_1_program_html_a86d24d735c64eb7c67a935b809927dd4"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a86d24d735c64eb7c67a935b809927dd4">Tgstation.Server.Host.Service.Program.OnExecuteAsync</a></div><div class="ttdeci">async Task OnExecuteAsync()</div><div class="ttdoc">Command line handler, always runs</div><div class="ttdef"><b>Definition:</b> <a href="_tgstation_8_server_8_host_8_service_2_program_8cs_source.html#l00078">Program.cs:78</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_service_1_1_program_html_a938d576ceba93bf3cb1a32ae1dcccc52"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#a938d576ceba93bf3cb1a32ae1dcccc52">Tgstation.Server.Host.Service.Program.Debug</a></div><div class="ttdeci">bool Debug</div><div class="ttdoc">The –debug or -d option. Enables debug logs</div><div class="ttdef"><b>Definition:</b> <a href="_tgstation_8_server_8_host_8_service_2_program_8cs_source.html#l00056">Program.cs:56</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_service_1_1_program_html_aaba3eb445c2c2c0f8a11d150096b7457"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#aaba3eb445c2c2c0f8a11d150096b7457">Tgstation.Server.Host.Service.Program.Configure</a></div><div class="ttdeci">bool Configure</div><div class="ttdoc">The –configure or -c option</div><div class="ttdef"><b>Definition:</b> <a href="_tgstation_8_server_8_host_8_service_2_program_8cs_source.html#l00044">Program.cs:44</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_service_1_1_program_html_ae3be244b24cbb3c9ba859f55e53715e6"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_program.html#ae3be244b24cbb3c9ba859f55e53715e6">Tgstation.Server.Host.Service.Program.Install</a></div><div class="ttdeci">bool Install</div><div class="ttdoc">The –install or -i option</div><div class="ttdef"><b>Definition:</b> <a href="_tgstation_8_server_8_host_8_service_2_program_8cs_source.html#l00038">Program.cs:38</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_service_1_1_server_service_html"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_server_service.html">Tgstation.Server.Host.Service.ServerService</a></div><div class="ttdoc">Represents a IWatchdog as a ServiceBase</div><div class="ttdef"><b>Definition:</b> <a href="_server_service_8cs_source.html#l00016">ServerService.cs:17</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_service_1_1_server_service_html_a82a1c35bb13819cd1003592351251fc1"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_service_1_1_server_service.html#a82a1c35bb13819cd1003592351251fc1">Tgstation.Server.Host.Service.ServerService.Name</a></div><div class="ttdeci">const string Name</div><div class="ttdoc">The canonical windows service name</div><div class="ttdef"><b>Definition:</b> <a href="_server_service_8cs_source.html#l00021">ServerService.cs:21</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_watchdog_1_1_watchdog_factory_html"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_watchdog_1_1_watchdog_factory.html">Tgstation.Server.Host.Watchdog.WatchdogFactory</a></div><div class="ttdef"><b>Definition:</b> <a href="_tgstation_8_server_8_host_8_watchdog_2_watchdog_factory_8cs_source.html#l00007">WatchdogFactory.cs:8</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_watchdog_1_1_watchdog_factory_html_ae25446ee2a7bb19d9208695d18621914"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_watchdog_1_1_watchdog_factory.html#ae25446ee2a7bb19d9208695d18621914">Tgstation.Server.Host.Watchdog.WatchdogFactory.CreateWatchdog</a></div><div class="ttdeci">IWatchdog CreateWatchdog(ILoggerFactory loggerFactory)</div><div class="ttdoc">Create a IWatchdog</div></div>
<div class="ttc" id="ainterface_tgstation_1_1_server_1_1_host_1_1_watchdog_1_1_i_watchdog_factory_html"><div class="ttname"><a href="interface_tgstation_1_1_server_1_1_host_1_1_watchdog_1_1_i_watchdog_factory.html">Tgstation.Server.Host.Watchdog.IWatchdogFactory</a></div><div class="ttdoc">Factory for creating IWatchdogs</div><div class="ttdef"><b>Definition:</b> <a href="_tgstation_8_server_8_host_8_watchdog_2_i_watchdog_factory_8cs_source.html#l00008">IWatchdogFactory.cs:9</a></div></div>
<div class="ttc" id="ainterface_tgstation_1_1_server_1_1_host_1_1_watchdog_1_1_i_watchdog_html_abe13ec45a7d7ba7db422ea661156b697"><div class="ttname"><a href="interface_tgstation_1_1_server_1_1_host_1_1_watchdog_1_1_i_watchdog.html#abe13ec45a7d7ba7db422ea661156b697">Tgstation.Server.Host.Watchdog.IWatchdog.RunAsync</a></div><div class="ttdeci">Task RunAsync(bool runConfigure, string[] args, CancellationToken cancellationToken)</div><div class="ttdoc">Run the IWatchdog</div></div>
<div class="ttc" id="anamespace_tgstation_1_1_server_1_1_host_1_1_service_html"><div class="ttname"><a href="namespace_tgstation_1_1_server_1_1_host_1_1_service.html">Tgstation.Server.Host.Service</a></div><div class="ttdef"><b>Definition:</b> <a href="_tgstation_8_server_8_host_8_service_2_program_8cs_source.html#l00016">Program.cs:17</a></div></div>
<div class="ttc" id="anamespace_tgstation_1_1_server_1_1_host_1_1_watchdog_html"><div class="ttname"><a href="namespace_tgstation_1_1_server_1_1_host_1_1_watchdog.html">Tgstation.Server.Host.Watchdog</a></div><div class="ttdef"><b>Definition:</b> <a href="_tgstation_8_server_8_host_8_watchdog_2_i_watchdog_8cs_source.html#l00004">IWatchdog.cs:5</a></div></div>
<div class="ttc" id="anamespace_tgstation_1_1_server_1_1_host_html"><div class="ttname"><a href="namespace_tgstation_1_1_server_1_1_host.html">Tgstation.Server.Host</a></div><div class="ttdef"><b>Definition:</b> <a href="_byond_executable_lock_8cs_source.html#l00008">ByondExecutableLock.cs:9</a></div></div>
<div class="ttc" id="anamespace_tgstation_1_1_server_html"><div class="ttname"><a href="namespace_tgstation_1_1_server.html">Tgstation.Server</a></div><div class="ttdef"><b>Definition:</b> <a href="_api_headers_8cs_source.html#l00014">ApiHeaders.cs:15</a></div></div>
<div class="ttc" id="anamespace_tgstation_html"><div class="ttname"><a href="namespace_tgstation.html">Tgstation</a></div><div class="ttdef"><b>Definition:</b> <a href="_api_headers_8cs_source.html#l00014">ApiHeaders.cs:15</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
